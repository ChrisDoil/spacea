!function(a){"use strict";function b(){var a=$(document.body);i=a.hasClass("base-page")?"base":a.hasClass("functional-page")?"functional":"org",j.pageInit(),c(),d()}function c(){}function d(){j.addClickEvent(".saveMyBase","click"),j.addClickEvent("#subMenus","click")}function e(a,b){var c=$(b),d=c.next("ul");d.length&&(c.toggleClass("arrowOpen"),d.slideToggle("fast"))}function f(a){n&&a.preventDefault()}function g(a){var b=a.target.getAttribute("data-form"),c=j.parseAttribute(b);a.preventDefault(),k.makeApiCall("saveMyBase",c,{success:function(a){h=l.createPopup({title:p[i],isOpenOnCreate:!1}),h.setContent(o(a)),h.open()}})}var h,i,j=a.addPageCtrl("basePageController"),k=(a.messagingAPI,a.api),l=a.modal,m=a.templateEngine.compose,n=!1,o=m($("#save-my-base-template").html());j.extend({init:b,saveMyBase:g,disableLink:f,toggleSubList:e});var p={org:"Save as My Organization",functional:"Save as My Functional Area",base:"Save as My Base"};j.run()}(afp),function(a){"use strict";function b(a,b){N=a,b&&(O=b),x(D.srcData)}function c(a,b){var c=$.inArray(b,a);return c>=0?e(a,b):(a.push(b),d(a,b))}function d(a,b){var c=$.inArray(b,a);return c>=0?a:(a.push(b),a)}function e(a,b){var c=$.inArray(b,a),d=[];if(c>=0){for(var e=0;e<a.length;e++)c!==e&&d.push(a[e]);return d}return a}function f(a,b){R.property;R={property:a,direction:b},g(),F.send("indexDataReady",y(H))}function g(){D[R.property](H,R.direction)}function h(a,b){return"ascending"==b?a.sort(function(a,b){return a.displayTitle.toUpperCase()<b.displayTitle.toUpperCase()?-1:a.displayTitle.toUpperCase()>b.displayTitle.toUpperCase()?1:0}):a.sort(function(a,b){return a.displayTitle.toUpperCase()>b.displayTitle.toUpperCase()?-1:a.displayTitle.toUpperCase()<b.displayTitle.toUpperCase()?1:0}),a}function i(a,b){return a.sort(function(a,b){return a.lastModTime.time<b.lastModTime.time?-1:a.lastModTime.time>b.lastModTime.time?1:0}),a}function j(a){if("ALL"==a){l.call(D,"filterLetter",null,"delete")}else{l.call(D,"filterLetter",a)}}function k(a){for(var b=H||G,c=[],d=b.length;d--;)b[d].indexKey==a&&c.unshift(b[d]);return c}function l(a,b,d){var e,f=O.hasOwnProperty(a),g=O[a];switch(d){case"update":"filterFunctionalArea"==a&&delete O.filterLetter,"filterSearch"==a&&(g=null,f=!1,delete O.filterSearch),f?(O[a]=c(g,b),0===O[a].length&&delete O[a]):O[a]=[b];break;case"delete":f&&delete O[a];break;default:O={},O[a]=[b]}e=this.buildFilteredData(),F.send("indexDataReady",y(e))}function m(a,b){return q(a,"majcom",b)}function n(a,b){return"OCONUS"==b[0]?q(a,"isConus",[!1]):"CONUS"==b[0]?q(a,"isConus",[!0]):q(a,"country",b)}function o(a,b){return q(a,"state",b)}function p(a,b){return q(a,"functionalArea",b)}function q(a,b,c){for(var d,e=[],f=a.length,g=0;f>g;g++){d=a[g];for(var h=0;h<c.length;h++)d[b]==c[h]&&e.push(d)}return e}function r(a,b){for(var c,d=[],e=b.join(""),f=0;f<a.length;f++)c=a[f].indexKey,e.indexOf(c)>=0&&d.push(a[f]);return d}function s(a,b){for(var c,d=[],e=0;e<a.length;e++)switch(c=a[e],b[0]){case"true":c.externalMapUrl&&""!=c.externalMapUrl&&d.push(c);break;case"false":c.externalMapUrl&&""!=c.externalMapUrl||d.push(c);break;default:return a}return d}function t(a,b){var c,d,e=[],f=a.length;if(b=b[0],!b)return a;b=b.toLowerCase().replace(/[\^\$\?\*\(\)\[\]\/\\\.\+]/g,"\\$1"),c=new RegExp(b);for(var g=0;f>g;g++)d=a[g][T[0]].toLowerCase(),c.test(d)&&e.push(a[g]);return e}function u(a){S&&S.abort(),P=a=a||{},"topLevel"==a.view&&Q&&(H.length=0),S=E.makeApiCall("getOrgData",a,{success:function(a){G=a.data.organizations,H=G,"topLevel"!=P.view||Q||(Q=a),w()}})}function v(){H=G;for(var a in O)H=this[a](H,O[a]);return H=this[R.property](H,R.direction)}function w(a){N in U&&U[N](H),g(),a?(D.buildFilteredData(),F.send("indexInitialDataReady",y(H))):F.send("indexDataReady",y(H))}function x(a){a&&(G=a,H=G,w(!0))}function y(a){var b=a||"array"==typeof a?!0:!1,c={data:b?a:G,letters:L,symbols:K,majcoms:I.slice(0,-1).split("|"),states:J.slice(0,-1).split("|"),appliedFilters:O,appliedQueries:P,currentSort:R,types:M};return c}function z(a){var b=L,c="#"==b[0]?b[1]:b[0];return k(c)}function A(a){function b(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}for(var c="",d="",e="",f=0;f<a.length;f++)a[f].displayTitle=b(a[f].displayTitle),c=a[f].displayTitle.charAt(0).toUpperCase(),/[A-Z]/.test(c)?(a[f].indexKey=c,d.indexOf(c)<0&&(d+=c)):(a[f].indexKey="#",d.indexOf("#")<0&&(d+="#"),e.indexOf(c)<0&&(e+=c));L=d.split(""),K=e.split("")}function B(a,b){for(var c,d="",e=a.length;e--;)c=a[e][b],c&&d.indexOf(c+"|")<0&&(d=d+c+"|");d=d.slice(0,-1),M[b]=d.split("|"),M[b].sort()}function C(a,b){var c,d,e=["CONUS","OCONUS","US"],f=[],g=a.length;for(B(a,b),a=M.country,c=0;c<e.length;c++)f.push(e[c]);for(c=0;g>c;c++)d=a[c],d&&$.inArray(d,f)<0&&f.push(d);M[b]=f}var D=a.addModule("indexModel"),E=a.api,F=a.messagingAPI,G=[],H=[],I="",J="",K=[],L=[],M={},N="",O={filterLetter:["A"]},P={letter:"A"},Q=null,R={property:"sortName",direction:"ascending"},S=null,T=["displayTitle"];D.extend({init:b,filter:l,setData:x,sort:f,query:u,sortName:h,sortDate:i,pickLetter:j,filterMajcom:m,filterCountry:n,filterState:o,filterMap:s,filterSearch:t,filterLetter:r,filterFunctionalArea:p,buildFilteredData:v}),D.storeData=function(a){this.srcData=a};var U={functional:function(a){return A(a),a},base:function(a){return A(a),B(a,"majcom"),B(a,"state"),C(a,"country"),z(a)},app:function(a){return A(a),B(a,"functionalArea"),a},org:function(a){var b,c,d=P.organizations;if(a=a.length?a:G,d&&"all"!=d)for(d=d.toUpperCase(),c=a.length,H=[];c--;)b=a[c],b.type!=d||b.isPrivate||H.push(b);else H=a;return H}}}(afp),function(a){"use strict";function b(b){if(N=j(),e(),"org"==N){q(N);var f=Y.getCurrentParams();h(f.type),S.init(N,{}),_.html(p()),L.query(f)}else"app"==N?(q(N),S.init(N,{filterLetter:["A"]})):N&&(q(N),S.init(N));"appModal"==b&&(d(),N=b,aa=!1,_&&0!=_.length||(Z=document.getElementById("dataGrid"),_=$(Z)),q("app"),_.html(p()),document.getElementById("appFav")&&a.indexModel.init("app",{filterLetter:["A"]})),c()}function c(){O.addClickEvent(document.getElementById("applicationsList")),O.addClickEvent(document.getElementById("basesList")),$(document.body).on("keyup",".searchField, .searchInput",function(){O.startSearch.call(this)}),$(".sortType").on("change",function(a){O.sort(a,$(this).find("option:selected").get(0))}),!afpConfig.isIE8,$("form[name=appSearch]").submit(function(a){return a.preventDefault(),!1})}function d(){O.removeClickEvent(document.getElementById("applicationsList")),O.removeClickEvent(document.getElementById("basesList"))}function e(){I=$("#filterArea"),J=$(".indexList button"),K=$("#numbers p")}function f(a,b){var c=O.parseAttribute(b.getAttribute("data-bind")),d=$(b).closest(".searchGroup").find(".searchInput");"ALL"!==ea&&(c.type=ea),c.searchText=d.val(),_.html(p()),L.query(c)}function g(a,b){var c=O.parseAttribute(b.getAttribute("data-bind"));$(b);h(c.type),_.html(p()),L.query(c)}function h(a){var a=a||"all",b=$("#"+a.toLowerCase()+"-tab"),c=$(".tab"),d=$(".searchField");c.removeClass("active"),b.addClass("active"),d.val(""),J.removeClass("selected"),ea=a.toUpperCase()}function i(a,b){var c=O.parseAttribute(b.getAttribute("data-bind")),d=$(b);J.removeClass("selected"),d.addClass("selected"),"ALL"!==ea&&(c.type=ea),_.html(p()),L.query(c)}function j(){return da[document.body.id]}function k(a,b){var c=$(b),d=(O.parseAttribute(b.getAttribute("data-bind")),a.target,c.closest("td"));Q.makeApiCall("addPortalFavorite",JSON.stringify({displayTitle:d.find(".appName").text().trim(),url:d.find(".application-url").attr("href")}),{success:function(a){W.sendVirtualTracker({type:"add-application",title:c.closest(".nameCell").find(".appName").text().trim(),includeSiteTitle:!0}),l()},error:function(a){return o({title:"APPLICATION WAS NOT ADDED",message:a.message,okBtn:"OK"}),!1}})}function l(){Q.makeApiCall("readPortalFavorite",{},{success:function(a){var b=a.afpMyPortalFavorites.favorites;$.each(b,function(a,b){$.each(b,function(a,b){var c=$('.applicationTable tr a[href="'+b.url+'"]').closest("tr");if(c){c.addClass("added");var d=c.find(".modifyButtons").attr("data-bind");d+="; deleteID:"+b.id,c.find(".modifyButtons").attr("data-bind",d)}})})}})}function m(a,b){var c=$(b),d=O.parseAttribute(b.getAttribute("data-bind")),e=a.target;Q.makeApiCall("deletePortalFavorite",{type:"application",ids:d.deleteID},{success:function(a){W.sendVirtualTracker({type:"remove-application",title:c.closest(".nameCell").find(".appName").text().trim(),includeSiteTitle:!0}),$(e).parents("tr").removeClass("added")}})}function n(a,b){var c=O.parseAttribute(b.getAttribute("data-bind")),d=(a.target,X.createPopup({isOpenOnCreate:!1,title:"Request Access"})),e=$('[data-id="'+c.id+'"]').find(".accordionContent").html(),f='<p class="buttons"><button data-action="close" type="button" class="primaryBtn primaryCTA">CLOSE</button></p>';e+=f,d.replaceContent(e),d.open()}function o(a){X.alert({title:a.title||"",message:a.message||"",okBtn:a.okBtn}).onOK=function(a){this.closeModal()}}function p(){return $('<div class="loadingContainer"><img src="'+baseUrl+'/afp/assets/icons/indeterminateMeter-STD.gif" class="loading" alt="Loading" title="Loading" /></div>')}function q(a){return L=new G(a)}function r(){return!aa}function s(){L&&(e(),L.indexDataReady(L.dataObj))}function t(a,b){var c=$(b).closest(".indexList").find(".letterContainer");c.hasClass("open")?(w(a,K),u(a,b)):(ba.on("click.dropdown",function(a){ba.off("click.dropdown"),t(a,b)}),c.removeClass("close").addClass("open"))}function u(a,b){var c=$(b).closest(".indexList").find(".letterContainer");c.removeClass("open").addClass("close"),ba.off("click.dropdown")}function v(a,b){K.is(":visible")?w(null,null):(K.addClass("selected"),K.parents(".letterContainer").addClass("numberOpen"))}function w(a,b){K.is(":visible")&&(K.removeClass("selected"),K.parents(".letterContainer").removeClass("numberOpen"))}function x(a,b){var c=$(b),d=c.parent();d.hasClass("open")?d.removeClass("open").addClass("close"):d.removeClass("close").addClass("open")}function y(a){var b;"string"!=typeof a&&(b=a.data,a=b.length&&b[0].indexKey||null),H&&(/[1-9]/.test(H.attr("data-letter"))&&$("[data-letter=#]").addClass("selected"),H.removeClass("selected")),a&&(/[1-9]/.test(a)&&$("[data-letter=#]").addClass("selected"),H=J.filter('button[data-letter="'+a+'"]').addClass("selected"))}function z(a,b){$("html, body").animate({scrollTop:0})}function A(){var a=this;M&&clearTimeout(M),M=setTimeout(function(){M=null;var b=S||afp.indexModel,c="app"===N?"create":"update";b.filter("filterSearch",a.value,c)},ca)}function B(a,b){var c=$(b),d=c.attr("data-filterKey"),e=c.attr("data-filterType"),f=c.attr("data-command");L.filter(e,d,f)}function C(a,b){/(^|\b)active(\b|$)/.test(b.className)&&(u(a,b),L.pickLetter(b.getAttribute("data-letter")))}function D(a,b){var c=b.getAttribute("data-sortProperty"),d=b.getAttribute("data-sortDirection");L.sort(c,d)}function E(a,b,c){var d,e=a.join("");"org"!=N&&J.each(function(a,b,c){var f=$(b);d=f.attr("data-letter"),d&&e.indexOf(d)>=0?f.addClass("active"):f.removeClass("active"),"ALL"==d&&f.addClass("active"),f.removeClass("selected")})}function F(){$(".custom_select").each(function(){T.wireOneSelect(this)})}function G(b){this.appliedFilters,this.type=b,this.dynamicHTML,this.model=a.indexModel,this.setUp(b)}var H,I,J,K,L,M,N,O=a.addModule("indexListController"),P=a.messagingAPI,Q=a.api,R=a.templateEngine.compose,S=a.indexModel,T=a.customSelects,U=a.customInputs,V=a.customScrollBars,W=a.angelfish,X=a.modal,Y=a.reusableComponents,Z=($('<div class="loadingContainer"><img src="'+baseUrl+'/afp/assets/icons/indeterminateMeter-STD.gif" class="loading" alt="Loading" title="Loading" /></div>'),document.getElementById("dataGrid")),_=$(Z),aa=!0,ba=$(document.body),ca=200,da={applicationIndexPage:"app",baseIndexPage:"base",functionalAreaIndexPage:"functional",organizationIndexPage:"org"},ea="ALL";O.extend({init:b,scrollToTop:z,filter:B,sort:D,queryLetter:i,searchQuery:f,pickLetter:C,openNumbers:v,startSearch:A,toggleDropdown:t,toggleAccordion:x,addApplication:k,checkAddedApps:l,removeApplication:m,requestAccess:n,switchTab:g,isInit:r,configureForModalUse:s,unbindHandlers:d});(function(a){function b(){var a,b;d||(f=document.querySelector("#site-title"),g=f.querySelector("a"),h=document.querySelector(".breadcrumbs a"),b=document.createElement("a"),b.href=h.href,a=g.textContent||g.innerText,e=document.createElement("h2"),e.appendChild(b),e.appendChild(document.createTextNode(a)),a=h.textContent||h.innerText,d=document.createElement("h2"),d.appendChild(document.createTextNode(a)),c=document.querySelector("#main-content"))}var c,d,e,f,g,h;return function(a){a.matches?(d||b(),c.insertBefore(e,c.firstChild),f.parentNode.replaceChild(d,f)):d&&(c.removeChild(e),d.parentNode.replaceChild(f,d))}})();G.prototype.pickLetter=function(a){this.model.pickLetter(a),y(a)},G.prototype.selectedLetterReady=function(a){this.buildIndexList(a)},G.prototype.buildIndexList=function(b){var c=this.dynamicHTML,d=c[0],e=$(d.target);"appModal"==N?$("#dataGrid").html(d.template(b)):e.get(0).innerHTML=d.template(b),a.angelfish.viewRendered(e),document.getElementById("indexSearch")&&U.wireOneInput(document.getElementById("indexSearch")),$(".applicationTable td.nameCell, .applicationTable td.infoCell").hover(function(a){$(this).parents("tr").addClass("showButton")},function(a){$(this).parents("tr").removeClass("showButton")}),P.send("index.templateRendered")},G.prototype.indexInitialDataReady=function(a){var b=this.dynamicHTML,c=b[1];this.indexDataReady(a,!0),"app"==N&&(y("A"),c&&$(c.target).html(c.template(a)));var d=[];$(".filterCheckbox").on("change",function(a){var b=$(".filterFunctionalArea"),c=$("#fa-all"),e=!1;d=[],"fa-all"==this.id&&1==this.checked?(b.each(function(){this.checked=!1}),$("#filterDropDown .value").html("All")):(b.each(function(){return this.checked?(e=!0,!1):void 0}),e?c.get(0).checked=!1:c.get(0).checked=!0),O.filter(a,this),$("#filterDropDown .filterCheckbox").each(function(){this.checked&&"on"!=this.value&&d.push(this.value)});var f="ALL";1==d.length?f=d[0]:d.length>1&&(f=d.length+" Selected"),$("#filterDropDown .value").html(f)}),$("#filterDropDown .filterSelect").click(function(){$("#filterDropDown").addClass("open"),V.createScrollBars($("#filterDropDown").find(".customScrollBar"))}),$("#filterDropDown").mouseleave(function(){$("#filterDropDown").removeClass("open")})},G.prototype.indexDataReady=function(a,b){function c(){$(".abstractContainer").addClass("open"),d(),$(".indexListDropdown").on("change",function(a){C(null,$(a.target).find(":selected").get(0))})}function d(){var a="#ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");a.unshift("MISC");for(var b=0;b<a.length;b++){var c=$('[data-sort-letter="'+a[b]+'"]');$("[data-sort-letter="+a[b]+"]").eq(0).prepend($("<td/>").addClass("letterCell").html(a[b]).attr("rowspan",c.length)),$("[data-sort-letter="+a[b]+"]").last().addClass("last")}}function e(a){var b,c,d=a.organizations||"all";e.orgTabs||(e.orgTabs=document.getElementById("orgTabs")),c=e.orgTabs,b=c.querySelector(".selectedFilter"),b&&(b.className=""),b=c.querySelector("button[data-organizations="+d+"]"),b&&(b.parentNode.className="selectedFilter"),$(".indexListDropdown").on("change",function(a){C(null,$(a.target).find(":selected").get(0))})}function f(){var a=$(".indexListDropdown"),b=$("#countryDropdownContent"),c=$("#statesHeader");$("#clearStateFilter");a.on("change",function(a){C(null,$(a.target).find(":selected").get(0))}),b.on("change",function(a){var b=$(a.target),d=b.find(":selected").attr("data-filterKey");"string"==typeof d&&"us"===d.toLowerCase()?c.removeClass("hidden"):c.addClass("hidden"),B(null,b.find(":selected"))})}var g,h=this.appliedFilters,i=(a.appliedFilters,'<button data-action="filter" data-filterType="%currentType%" data-filterKey="-1">%currentType%: %currentKey% [x]</button>'),j=[];this.dataObj=a,this.buildIndexList(a),l(),E(a.letters,a.symbols,a.appliedFilters.filterLetter||-1);for(var k=0;k<h.length;k++)g=h[0],-1!=g.currentKey&&j.push(i.replace(/%(\w+)%/g,function(a,b){return g[b]}));switch($(h).html(j),F(),this.type){case"org":e(a.appliedQueries);break;case"base":f();break;case"app":case"functional":c()}y(a)},G.prototype.setUpTemplates=function(a){var b=[];switch(a){case"base":b.push({template:R("baseTemplate"),target:Z});break;case"functional":b.push({template:R("functionalTemplate"),target:Z});break;case"org":b.push({template:R("orgTemplate"),target:Z});break;case"app":b.push({template:R("appTemplate"),target:Z})}this.dynamicHTML=b},G.prototype.filter=function(a,b,c){this.model.filter(a,b,c)},G.prototype.sort=function(a,b){this.model.sort(a,b)},G.prototype.query=function(a){this.model.query(a)},G.prototype.setUp=function(a){this.appliedFilters=document.getElementById("appliedFilters"),this.setUpTemplates(a),P.register(this,[{messageType:"indexInitialDataReady"},{messageType:"indexDataReady"},{messageType:"selectedLetterReady"}])},G.prototype.getDataObj=function(a){for(var b=a.children[0].textContent,c=this.data.data,d=c.length,e={},f=0;d>f;f++)if(e=c[f],e.displayTitle==b)return e},G.prototype.listener=O.listener,O.run()}(afp);